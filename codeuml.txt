Actor Заказчик
Actor Прораб
Actor Менеджер
Actor Поставщик


Заказчик -> Менеджер: Запрос строительных работ
activate Менеджер
    Менеджер-> Менеджер: Создать заказ
    activate Менеджер #FFBBBB
    Менеджер -> Менеджер: Создать смету
    activate Менеджер #C41E3A    
    Менеджер -> Склад: Запросить ресурсы со склада
    activate Склад
    alt Есть ресурсы на складе
    	Склад ->> Менеджер: Получить ресурсы        
    else Нет ресурсов на складе
    	Склад ->> Менеджер: Склад пуст
        Менеджер -> Поставщик: Покупка ресурсов у поставщика
        activate Поставщик
        Поставщик -> Склад: Отправка товара на склад
        deactivate Поставщик
        Склад -> Менеджер: Отправка ресурсов
    end
    deactivate Склад
    deactivate Менеджер
    Менеджер -> Прораб : Отправка ресурсов и Запрос на исполнение
    activate Прораб
    Прораб -> Прораб : Выполнеие работ
    Прораб -> Заказчик: Запрос на приём работы
    alt Приём работы
        Заказчик ->> Прораб: Приём работы
    else Доработка
        loop До тех пор пока заказчик не примет работу
        Заказчик ->> Прораб: Запрос на доработку
        Прораб -> Менеджер: Отправка списка работ
        Менеджер -> Заказчик: Запрос на 85% оплату от текущей стоимости заказа
        Заказчик -> Менеджер: Оплата
        Менеджер -> Менеджер: Внесение оплаты в заказ
        Менеджер -> Менеджер: Добавить смету доработок
        activate Менеджер #C41E3A
        Менеджер -> Склад: Запросить ресурсы со склада
    	activate Склад
        alt Есть ресурсы на складе
    		Склад ->> Менеджер: Получить ресурсы        
   		 else Нет ресурсов на складе
    		Склад ->> Менеджер: Склад пуст
    	    Менеджер -> Поставщик: Покупка ресурсов у поставщика
    	    activate Поставщик
    	    Поставщик -> Склад: Отправка товара на склад
    	    deactivate Поставщик
    	    Склад -> Менеджер: Отправка ресурсов
    	end
        deactivate Склад
        deactivate Менеджер
        Менеджер -> Прораб: Отправка ресурсов и Запрос на исполнение
        Прораб -> Заказчик: Запрос на приём работы*
        end
    end
    
    Прораб -> Менеджер: Рапорт о завершении работ
    deactivate Прораб    
    Менеджер -> Заказчик: Запрос оплаты
    Заказчик -> Менеджер: Оплата текущей стоимости заказа    
    Менеджер -> Менеджер: Закрытие заказа
    deactivate Менеджер
    Менеджер -> Прораб: Оплата работы
deactivate Менеджер