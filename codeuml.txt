Actor Заказчик
Actor Прораб
Actor Менеджер


Заказчик -> Менеджер: Запрос строительных работ
activate Менеджер
    Менеджер -> Заказ: Создать заказ
    activate Заказ #FFBBBB
    Заказ -> Смета: Создать смету
    activate Смета #C41E3A    
    Менеджер -> Склад: Запросить ресурсы со склада
    activate Склад
    alt Есть ресурсы на складе
    	Склад -> Менеджер: Получить ресурсы        
    else Нет ресурсов на складе
    	Склад -> Менеджер: Склад пуст
        Менеджер -> Менеджер: Покупка ресурсов у поставщика
        activate Менеджер #FFBBBB
        Менеджер -> Склад: Отправка товара на склад
        deactivate Менеджер
        Склад -> Менеджер: Получить ресурсы
    end
    deactivate Склад
    deactivate Смета
    Менеджер -> Прораб : Отправка ресурсов и Запрос на исполнение
    activate Прораб
    Прораб -> Прораб : Выполнеие работ
    Прораб -> Заказчик: Запрос на приём работы
    alt Приём работы
        Заказчик -> Прораб: Приём работы
    else Доработка
        loop До тех пор пока заказчик не примет работу
        Заказчик -> Прораб: Запрос на доработку
        Прораб -> Менеджер: Отправка списка работ
        Менеджер -> Заказчик: Запрос на 85% оплату от текущей стоимости заказа
        Заказчик -> Менеджер: Оплата
        Менеджер -> Заказ: Внесение оплаты в заказ
        Менеджер -> Смета: Добавить смету доработок
        activate Смета #C41E3A
        Менеджер -> Склад: Запросить ресурсы со склада
    	activate Склад
        alt Есть ресурсы на складе
    		Склад -> Менеджер: Получить ресурсы        
    	else Нет ресурсов на складе
    		Склад -> Менеджер: Склад пуст
        	Менеджер -> Менеджер: Покупка ресурсов у поставщика
        	activate Менеджер #FFBBBB
        	Менеджер -> Склад: Отправка товара на склад
        	deactivate Менеджер
        	Склад -> Менеджер: Получить ресурсы
    	end
        deactivate Склад
        deactivate Смета
        Менеджер -> Прораб: Отправка ресурсов и Запрос на исполнение
        Прораб -> Заказчик: Запрос на приём работы*
        end
    end
    
    Прораб -> Менеджер: Рапорт о завершении работ
    deactivate Прораб    
    Менеджер -> Заказчик: Запрос оплаты
    Заказчик -> Менеджер: Оплата текущей стоимости заказа    
    Заказ -> Менеджер: Закрытие заказа
    deactivate Заказ
    Менеджер -> Прораб: Оплата работы
deactivate Менеджер

